
generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"

}

// User role enum
enum UserRole {
  USER
  ADMIN
}

// User model for authentication and user management
model User {
  id               String   @id @default(cuid())
  email             String   @unique
  password          String
  firstName         String?
  lastName          String?
  phone             String?
  personalIdNumber  String   @unique
  role              UserRole @default(USER)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  addresses Address[]
  parcels   Parcel[]
  payments  Payment[]
  orders    Order[]

  @@map("users")
}

// Address model for shipping addresses
model Address {
  id          String   @id @default(cuid())
  userId      String
  type        String   // "shipping" | "billing" | "pickup"
  country     String
  city        String
  street      String
  building    String?
  apartment   String?
  postalCode  String?
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  parcels     Parcel[]

  @@map("addresses")
}

// Parcel model for packages/shipments
model Parcel {
  id              String   @id @default(cuid())
  userId          String
  trackingNumber  String   @unique
  status          String   @default("pending") // "pending" | "in_transit" | "arrived" | "ready_for_pickup" | "delivered" | "cancelled"
  
  // Origin information
  originCountry   String
  originAddress   String
  
  // Destination information
  destinationAddressId String?
  
  // Package details
  weight          Float    // in kg
  volumetricWeight Float?  // in kg
  length          Float?   // in cm
  width           Float?   // in cm
  height          Float?   // in cm
  description     String?
  
  // Pricing
  price           Float
  currency        String   @default("USD")
  
  // Customs
  customsValue    Float?
  customsDeclared Boolean  @default(false)
  
  // Dates
  shippedAt       DateTime?
  arrivedAt       DateTime?
  readyAt         DateTime?
  deliveredAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  address         Address? @relation(fields: [destinationAddressId], references: [id])
  tracking        Tracking[]
  payments        Payment[]
  order           Order?

  @@map("parcels")
}

// Tracking model for tracking updates
model Tracking {
  id          String   @id @default(cuid())
  parcelId    String
  status      String
  location    String?
  description String?
  createdAt   DateTime @default(now())

  parcel      Parcel   @relation(fields: [parcelId], references: [id], onDelete: Cascade)

  @@map("trackings")
}

// Payment model for payment records
model Payment {
  id            String   @id @default(cuid())
  userId        String
  parcelId      String?
  orderId       String?
  amount        Float
  currency      String   @default("USD")
  status        String   @default("pending") // "pending" | "completed" | "failed" | "refunded"
  paymentMethod String   // "card" | "bank_transfer" | "balance"
  transactionId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  parcel        Parcel?  @relation(fields: [parcelId], references: [id])

  @@map("payments")
}

// Order model for service orders
model Order {
  id            String   @id @default(cuid())
  userId        String
  parcelId      String?  @unique
  type          String   // "forwarding" | "customs" | "courier" | "corporate"
  status        String   @default("pending") // "pending" | "processing" | "completed" | "cancelled"
  totalAmount   Float
  currency      String   @default("USD")
  weight        String   @default("") // წონა (kg)
  smsSent       Boolean  @default(false)
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  parcel        Parcel?  @relation(fields: [parcelId], references: [id])

  @@map("orders")
}

// Tariff model for pricing information
model Tariff {
  id            String   @id @default(cuid())
  originCountry String
  destinationCountry String @default("GE")
  minWeight     Float    @default(0)
  maxWeight     Float?
  pricePerKg    Float
  currency      String   @default("USD")
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("tariffs")
}

// Branch model for pickup points
model Branch {
  id          String   @id @default(cuid())
  name        String
  address     String
  city        String
  country     String   @default("GE")
  phone       String?
  email       String?
  latitude    Float?
  longitude   Float?
  workingHours String? // JSON string or formatted text
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("branches")
}
